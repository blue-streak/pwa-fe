tasks:

  start:
    - '@npm node index'

  build-all:
    - build
    - app-shell

  build:
    description: |
      Run the parcel bundler to create the production-ready assets
    tasks:
      - adaptor: npm
        command: |
          rm -rf dist/**
          parcel build src/index.html --public-url /
          cp -R src/favicons dist/favicons
          cp -R src/stubs dist/stubs
  serve:
    description: |
      Serve the dist folder (note: this will set `NODE_ENV=production`)
    tasks:
      - adaptor: npm
        env:
          NODE_ENV: production
        command: node index

  lighthouse:
    - adaptor: npm
      command: |
        lighthouse http://localhost:1234 --headless --view

  app-shell:
    description: |
      Render the App shell. Alias for `render-clean render-ts render-output`
    tasks:
      - render-clean
      - render-ts
      - tasks/shell.js

  render-clean:
    adaptor: npm
    command: rm -rf render/**

  render-ts:
    adaptor: npm
    command: >
      tsc src/render/index.tsx
      --jsx react --jsxFactory h
      --lib DOM,ES2015
      --outDir render/dist

  render-output:
    adaptor: sh
    command: node renderSubject/dist/renderSubject/index.js
